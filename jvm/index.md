# JVM


本内容根据B站[黑马程序员JVM完整教程](https://www.bilibili.com/video/BV1yE411Z7AP)整理记录。

<!--more-->

## JVM组成

![avator](/images/JVM组成.png)

## 内存结构

### 程序计数器

程序计数器通过寄存器实现

作用：记录下一条JVM指令执行的地址

特点：

- 线程私有
- 不会线程溢出

### 虚拟机栈

#### 定义

- 栈：线程运行时需要的内存空间。
- 栈帧：方法运行时需要的内存空间。
- 每个栈由多个栈帧组成，对应着每次方法调用时所占用的内存。
- 每个线程只能有一个活动栈帧，对应这当前正在执行的那个方法。

#### 问题辨析

1. GC是否会回收栈内存？
   - GC只会回收堆内存里的对象。
2. 栈内存是否越大越好？
   - 分配太大会导致线程数量减少。
3. 方法内的局部变量是否是线程安全？
   - 如果方法内变量没有逃离方法的作用范围，它就是线程安全的。

#### 栈内存溢出

通过-Xss设置栈内存，默认1024k。

1. 栈帧过多；
2. 栈帧过大。

#### 线程诊断

1. CPU占用过多
   - 定位：
     - top定位进程；
     - ps H -ep pid, tid, %cpu | grep pid 定位线程；
     - jstack pid。
2. 程序长时间没有输出结果
   - jstack pid

### 本地方法栈

#### 定义

- 为本地方法提供内存空间

### 堆

#### 定义

- 通过new关键字创建的对象，都会使用堆内存

#### 堆内存溢出




